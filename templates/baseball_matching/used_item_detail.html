<!-- used_item_detail.html -->
{% extends 'baseball_matching/base.html' %}
{% load humanize %}
{% block content %}
<div class="container py-4">
    <div class="row">
        <!-- 상품 이미지 -->
        <div class="col-md-7">
            <img src="{{ item.image.url }}" 
                 class="img-fluid rounded shadow" 
                 alt="{{ item.title }}"
                 style="width: 100%; max-height: 600px; object-fit: contain;">
        </div>
        
        <!-- 상품 정보 -->
        <div class="col-md-5">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">{{ item.title }}</h2>
                {% if item.seller == user.userprofile %}
                <div>
                    <a href="{% url 'baseball_matching:used_item_edit' item.id %}" 
                       class="btn btn-warning">수정</a>
                    <button type="button" class="btn btn-danger" 
                            data-bs-toggle="modal" data-bs-target="#deleteItemModal">
                        삭제
                    </button>
                </div>
                {% endif %}
            </div>
            <div class="fs-3 fw-bold mb-3">{{ item.price|intcomma }}원</div>
            
            <div class="seller-info mb-4 p-3 bg-light rounded">
                <h5 class="mb-2">판매자 정보</h5>
                <p class="mb-2">{{ item.seller.user.username }}</p>
                <button onclick="location.href='{% url 'baseball_matching:chat_room' item.seller.id %}'" 
                        class="btn btn-primary">
                    1:1 채팅하기
                </button>

                <!-- 판매 상태 섹션 -->
                <div class="mt-3 pt-3 border-top">
                    {% if item.seller == request.user.userprofile %}
                    <h6 class="mb-2">판매 상태 변경</h6>
                    <form method="post" action="{% url 'baseball_matching:change_item_status' item.id %}" class="d-flex gap-2">
                        {% csrf_token %}
                        <select name="status" class="form-select" onchange="this.form.submit()">
                            {% for value, label in item.STATUS_CHOICES %}
                            <option value="{{ value }}" {% if item.status == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                            {% endfor %}
                        </select>
                    </form>
                    {% else %}
                    <h6 class="mb-2">판매 상태</h6>
                    <span class="badge {% if item.status == '판매중' %}bg-success
                                     {% elif item.status == '예약중' %}bg-warning
                                     {% else %}bg-secondary{% endif %}">
                        {{ item.status }}
                    </span>
                    {% endif %}
                </div>
            </div>

            <table class="table">
                <tr>
                    <th width="30%">상품상태</th>
                    <td>{{ item.get_condition_display }}</td>
                </tr>
                <tr>
                    <th>상품분류</th>
                    <td>{{ item.get_item_type_display }}</td>
                </tr>
                <tr>
                    <th>카테고리</th>
                    <td>{{ item.category }}</td>
                </tr>
                <tr>
                    <th>브랜드</th>
                    <td>{{ item.brand }}</td>
                </tr>
            </table>

            <div class="description mt-4">
                <h5>상품 설명</h5>
                <p>{{ item.description|linebreaks }}</p>
            </div>
        </div>
    </div>
</div>

<!-- 삭제 확인 모달 -->
<div class="modal fade" id="deleteItemModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">물품 삭제 확인</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>정말로 이 물품을 삭제하시겠습니까?</p>
                <p class="text-danger">이 작업은 되돌릴 수 없습니다.</p>
            </div>
            <div class="modal-footer">
                <form method="post" action="{% url 'baseball_matching:used_item_delete' item.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">삭제</button>
                </form>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
            </div>
        </div>
    </div>
</div>

<style>
    .form-select {
        max-width: 200px;
    }
    .badge {
        font-size: 0.9rem;
        padding: 0.5em 1em;
    }
</style>
{% endblock %}